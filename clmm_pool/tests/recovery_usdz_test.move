module clmm_pool::recovery_usdz_tests {
    #[allow(unused_const)]
    const COPYRIGHT_NOTICE: vector<u8> = b"Â© 2025 Metabyte Labs, Inc.  All Rights Reserved.";
    #[allow(unused_const)]
    const PATENT_NOTICE: vector<u8> = b"Patent pending - U.S. Patent Application No. 63/861,982";

    use sui::test_scenario;
    use integer_mate::i32;
    use clmm_pool::tick;
    use sui::test_utils;

    #[test_only]
    public struct TestCoinA has drop, store {}
    #[test_only]
    public struct TestCoinB has drop, store {}

    /*
    state before the bug fix:
    */
    #[test_only]
    fun current_tick_index(): i32::I32 {
        i32::from(260)
    }

    fun current_liqudity(): u128 {
        181488754091958   
    }

    fun current_staked_liquidity(): u128 {
        181488555827781
    }

    #[test_only] 
    fun setup_tick_manager(ctx: &mut sui::tx_context::TxContext): tick::TickManager {
        tick::new_test(

1,
12345u64, // You can change this seed value

vector<u32>[
  4294967202, 0, 50, 51, 70, 85, 125, 140, 153, 159, 160, 176, 179, 186, 187, 193, 194, 200, 204, 209, 219, 234, 239, 242, 244, 249, 252, 260, 261, 269, 270, 274, 285, 294, 307, 316, 322, 329, 340, 353, 359, 360, 426, 436, 529, 582
],

vector<u128>[
  18360252116397850915, 18446744073709551616, 18492916316576902928, 18493840939277742112, 18511417556925360646, 18525305633078406209, 18562391463553092676, 18576317782563276931, 18588395710136867799, 18593972786520368559, 18594902461918390645, 18609783591502059407, 18612575128826310116, 18619090344462276728, 18620021275706800532, 18625607840708770864, 18626539097819960530, 18632127618364105992, 18635854230209054996, 18640513543194697708, 18649835664204063832, 18663827587683168327, 18668493894532688761, 18671294238622554032, 18673161368046416287, 18677830008516038832, 18680631753058011449, 18688105126671864233, 18689039508569234351, 18696516245789790586, 18697451048232603227, 18701190725416760230, 18711478694858107035, 18719900333922539087, 18732071615823744675, 18740502523324438936, 18746125236315252470, 18752687200331949559, 18763003499207932015, 18775202805872419708, 18780835929989040813, 18781774948310669081, 18843854075962085107, 18853277887573921709, 18941145370028697184, 18991403454949450639
],

vector<u128>[
  198264177, 37033045069, 14032041521, 1418329532, 9989058045, 43490714937, 414751344529, 17113896861, 100721410322, 7218114651, 15195411216, 210833517794, 3604963731317, 340282366920938463463374607220934693662, 340282366920938463463374607394735166387, 340282366920938463463374607017016866927, 638903176430, 19607465318, 340282366920938463463374606792865035026, 6958727589, 340282366920938463463374607424809483867, 88560802, 270028053890, 6911473710879, 340282366920938463463374603826715919337, 340282366920938463463374607403782507690, 340282366920938463463374600520294500577, 181017727035254, 340282366920938463463374426414041176202, 58192871955, 340282366920938463463374607421779153411, 340282366920938463463374607373575339501, 340282366920938463463374607388277496519, 340282366920938463463374607189725861332, 340282366920938463463374607417736169935, 340282366920938463463374607412160746138, 340282366920938463463374607430349881924, 4056099785, 340282366920938463463374607414654314595, 340282366920938463463374607331046801134, 340282366920938463463374607424550096805, 340282366920938463463374607416572800240, 1716600310, 340282366920938463463374607430051611146, 340282366920938463463374607427712111671, 340282366920938463463374607431569947279
],

vector<u128>[
  198264177, 37033045069, 14032041521, 1418329532, 9989058045, 43490714937, 414751344529, 17113896861, 100721410322, 7218114651, 15195411216, 210833517794, 3604963731317, 210833517794, 37033045069, 414751344529, 638903176430, 19607465318, 638903176430, 6958727589, 6958727589, 88560802, 270028053890, 6911473710879, 3605052292119, 27985703766, 6911473710879, 181017727035254, 181017727035254, 58192871955, 9989058045, 58192871955, 43490714937, 242042350124, 14032041521, 19607465318, 1418329532, 4056099785, 17113896861, 100721410322, 7218114651, 15195411216, 1716600310, 1716600310, 4056099785, 198264177
],

vector<u128>[
  0, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 1762123838204, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 57155627238562, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 99261080627, 0, 0, 0
],

vector<u128>[
  0, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 60164603786, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 60161674331641, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 77178399025, 0, 0, 0
],

vector<u128>[
  0, 1551574224755138090780, 1551525615002701994567, 1551497359191164855808, 1551497429290685674485, 1551598528754293637071, 1551584616388846352024, 1551623629832620700097, 1551645197721151490393, 1551651289316497652012, 1551651187698100992023, 1551596190576930870088, 1551630569579919342327, 1551601302109791522154, 1551600385024118548002, 1551608778766934988210, 1551608644975764071026, 1551631122515068137905, 1551614883805835886448, 1551612390062393452907, 1484455847005799787866, 1551626566346064668912, 1551628990227055298070, 1551629695511970792403, 1551628624871986335146, 1551631759249868869312, 1551632372234649227325, 1551647172818414624149, 3617284354159027, 5225171250537116, 7324953993208863, 1664682155239316, 3202419281712710, 0, 0, 0, 0, 47555988352739168, 0, 0, 0, 0, 3338082886821858, 0, 0, 0
],

vector<vector<u128>>[
  vector<u128>[],
  vector<u128>[88822220799076281556],
  vector<u128>[88741847531159455663],
  vector<u128>[88695128266051752581],
  vector<u128>[88695244171344111525],
  vector<u128>[88862405982865213987],
  vector<u128>[88839402733117718841],
  vector<u128>[88903909088564723279],
  vector<u128>[88932566382541624477],
  vector<u128>[88940120444230813015],
  vector<u128>[88939994429354002514],
  vector<u128>[88858539948865929947],
  vector<u128>[88914426326450170924],
  vector<u128>[88866991557431822931],
  vector<u128>[88865475212073069363],
  vector<u128>[88879353755089670304],
  vector<u128>[88879132539529291352],
  vector<u128>[88915112009918419420],
  vector<u128>[88889448065441684619],
  vector<u128>[88885324812395332865],
  vector<u128>[60354228887512511979],
  vector<u128>[88908764434867581841],
  vector<u128>[88912467803553290573],
  vector<u128>[88913342412823496861],
  vector<u128>[88912014734271342478],
  vector<u128>[88915901611605834356],
  vector<u128>[88916661761383064045],
  vector<u128>[88935015659901661390],
  vector<u128>[4485719685217049],
  vector<u128>[6479627046797059],
  vector<u128>[9083524297134066],
  vector<u128>[2064337990128147],
  vector<u128>[5262913736142225],
  vector<u128>[0],
  vector<u128>[0],
  vector<u128>[0],
  vector<u128>[0],
  vector<u128>[78630933122915748],
  vector<u128>[0],
  vector<u128>[0],
  vector<u128>[0],
  vector<u128>[0],
  vector<u128>[5519316942496712],
  vector<u128>[0],
  vector<u128>[0],
  vector<u128>[]
],

vector<u128>[
  0, 37033045069, 14032041521, 1418329532, 9989058045, 43490714937, 414751344529, 17113896861, 100721410322, 7218114651, 15195411216, 210833517794, 3604963731317, 340282366920938463463374607220934693662, 340282366920938463463374607394735166387, 340282366920938463463374607017016866927, 638903176430, 19607465318, 340282366920938463463374606792865035026, 6958727589, 340282366920938463463374607424809483867, 88560802, 270028053890, 6911473710879, 340282366920938463463374603826715919337, 340282366920938463463374607403782507690, 340282366920938463463374600520294500577, 181017727035254, 340282366920938463463374426414041176202, 58192871955, 340282366920938463463374607421779153411, 340282366920938463463374607373575339501, 340282366920938463463374607388277496519, 340282366920938463463374607189725861332, 340282366920938463463374607417736169935, 340282366920938463463374607412160746138, 340282366920938463463374607430349881924, 4056099785, 340282366920938463463374607414654314595, 340282366920938463463374607331046801134, 340282366920938463463374607424550096805, 340282366920938463463374607416572800240, 0, 0, 340282366920938463463374607427712111671, 0
],

vector<u128>[
  0u128, 30779052551729681u128, 20694864081141021u128, 14831609693969004u128, 14851228256930800u128, 35843518574696151u128, 32851771810476007u128, 41138299069073685u128, 44715167916278060u128, 45665308571014338u128, 45650565172156176u128, 35380987064907955u128, 42437152462781428u128, 36478021623429020u128, 36286460040782163u128, 38039193055301258u128, 38007980388054435u128, 42523232411306387u128, 39313972359245082u128, 38774591017903735u128, 25633152121145700u128, 41745230354778829u128, 42188555189277564u128, 42300968219053312u128, 42134241905194109u128, 42622694735831979u128, 42718227542791182u128, 44971964690125554u128, 563725218428921u128, 819421567315339u128, 1141733247406131u128, 259465068031535u128, 662415681508290u128, 0u128, 0u128, 0u128, 0u128, 11150444287842359u128, 0u128, 0u128, 0u128, 0u128, 1521033440758078u128, 0u128, 0u128, 0u128
],
            ctx
        )
    }

    #[test]
    fun test_recovery_usdz() {
        let mut scenario = test_scenario::begin(@0x1);
        let tick_manager = setup_tick_manager(scenario.ctx());

        let (calculated_liquidity, calculated_staked_liquidity) = tick_manager.calc_current_liquidity(current_tick_index());

        assert!(calculated_liquidity == current_liqudity(), 1);
        assert!(calculated_staked_liquidity <= current_liqudity(), 2);
        assert!(calculated_staked_liquidity == current_staked_liquidity(), 3);

        test_utils::destroy(tick_manager);
        scenario.end();
    }

}