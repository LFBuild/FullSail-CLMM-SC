module clmm_pool::recovery_eth_tests {
    #[allow(unused_const)]
    const COPYRIGHT_NOTICE: vector<u8> = b"Â© 2025 Metabyte Labs, Inc.  All Rights Reserved.";
    #[allow(unused_const)]
    const PATENT_NOTICE: vector<u8> = b"Patent pending - U.S. Patent Application No. 63/861,982";

    use sui::test_scenario;
    use integer_mate::i32;
    use clmm_pool::tick;
    use sui::test_utils;

    /*
    state before the bug fix:
    */
    #[test_only]
    fun current_tick_index(): i32::I32 {
        i32::neg_from(38158)
    }

    fun current_liqudity(): u128 {
        717771687871   
    }

    fun current_staked_liquidity(): u128 {
        714742739018
    }

    #[test_only] 
    fun setup_tick_manager(ctx: &mut sui::tx_context::TxContext): tick::TickManager {
        tick::new_test(

40,
12345u64, // You can change this seed value

vector<u32>[
  4294921696, 4294922576, 4294922856, 4294926936, 4294927216, 4294927616, 4294927656, 4294927816, 4294927896, 4294928016, 4294928056, 4294928096, 4294928136, 4294928176, 4294928216, 4294928256, 4294928296, 4294928376, 4294928416, 4294928456, 4294928496, 4294928576, 4294928656, 4294928696, 4294928736, 4294928776, 4294928896, 4294928976, 4294929016, 4294929056, 4294929096, 4294929176, 4294929216, 4294929296, 4294929416, 4294929576, 4294929616, 4294929656, 4294929696, 4294929736, 4294929816, 4294929856, 4294929936, 4294930016, 4294930136, 4294930216, 4294930256, 4294930296, 4294930336, 4294930376, 4294930416, 4294930496, 4294930576, 4294930616, 4294930696, 4294930736, 4294930776, 4294930856, 4294930896, 4294931016, 4294931136, 4294931216, 4294931256, 4294931776, 4294932016, 4294932696, 4294933576, 4294933696, 4294933736, 4294933816, 4294933856, 4294934056, 4294934256, 4294934296, 4294934336, 4294934376, 4294934416, 4294935696, 4294935736, 4294935816, 4294935856, 4294936056, 4294936296, 4294936336, 4294936376, 4294936416
],

vector<u128>[
  1887025678391148123, 1971904199235326356, 1999703609919181931, 2452207833323540376, 2486778444140822471, 2537012164217806910, 2542091011762777981, 2562508279193713349, 2572778325216083346, 2588260621509808777, 2593442063399880786, 2598633878024381884, 2603836086148500956, 2609048708578996741, 2614271766164281051, 2619505279794502159, 2624749270401628348, 2635268766484071651, 2640544314033179704, 2645830422706942997, 2651127113647689024, 2661752327111148220, 2672420124410200551, 2677770045305111475, 2683130676212763425, 2688502038573543119, 2704680729422854627, 2715520575597217035, 2720956779334514650, 2726403865814273869, 2731861856822669236, 2742810639788222748, 2748301475536148238, 2759316145368155412, 2775920976694640607, 2798216292120431004, 2803818044506949638, 2809431011047959556, 2815055214193089424, 2820690676436909844, 2831995468424154438, 2837664843382240129, 2849037664603628225, 2860456065930374885, 2877669530422772895, 2889202682824494213, 2894986580970331893, 2900782057908464173, 2906589136818488552, 2912407840926405794, 2918238193504712818, 2929933937395523349, 2941676555604360386, 2947565501255961727, 2959378783420799730, 2965303167182455921, 2971239410974721239, 2983147573669044826, 2989119540199006919, 3007107267289656480, 3025203239742037592, 3037327679202950989, 3043408108947972987, 3123570304756081327, 3161277051128241233, 3270603015040925281, 3417714922082839317, 3438281822290508425, 3445164922591859452, 3458972488638360586, 3465897009608270766, 3500728103403545262, 3535909237921787556, 3542987778657833410, 3550080489932651722, 3557187400114260220, 3564308537627466603, 3799870080012248098, 3807477044259118136, 3822736688409794627, 3830389429346094728, 3868883548795149290, 3915587479388839768, 3923426098429495723, 3931280409610548991, 3939150444346113331
],

vector<u128>[
  2758623, 9367874, 1768513, 17787704, 155733152, 106761360, 621499228, 346607875, 2379147566, 499947, 537206727, 346776325, 1215467857, 3360106329, 665465732, 83534406161, 57419885, 55478988297, 1426055684, 735353241, 30234425, 45609791797, 139536152, 452262500, 192930074, 752707, 4630774951, 10814942394, 1641993929, 348858487929, 154400802933, 340282366920938463463374607277367408523, 340282366920938463463374607430633611361, 340282366920938463463374607082909723527, 18519892, 340282366920938463463374607430531778269, 340282366920938463463374607431642930204, 340282366920938463463374607431146712228, 340282366920938463463374607431352873076, 340282366920938463463374607376327074521, 340282366920938463463374607420953269062, 340282366920938463463374607431760097172, 340282366920938463463374607430126217527, 340282366920938463463374607427136936558, 340282366920938463463374607431370984151, 340282366920938463463374607430815182733, 340282366920938463463374607353416449194, 340282366920938463463374607431765785316, 340282366920938463463374607431718741960, 340282366920938463463374607431572436636, 340282366920938463463374607431177693272, 340282366920938463463374607431004824667, 340282366920938463463374607386673699285, 340282366920938463463374607431020939478, 340282366920938463463374607427748434688, 340282366920938463463374607427006202810, 340282366920938463463374607431767458749, 340282366920938463463374607430505435508, 340282366920938463463374607431750423752, 340282366920938463463374607431713217711, 340282366920938463463374607431764316842, 340282366920938463463374607431766071206, 340282366920938463463374607431764809497, 340282366920938463463374607431131921083, 340282366920938463463374607431231004729, 340282366920938463463374607431765452833, 340282366920938463463374607431758843582, 208408875, 61584321, 21805005, 2248183, 8336743, 2359784, 104, 115682, 4085437, 134883, 340282366920938463463374607431580142966, 340282366920938463463374607431686286750, 340282366920938463463374607431744637938, 340282366920938463463374607431765963273, 340282366920938463463374607431759874713, 340282366920938463463374607431765851672, 340282366920938463463374607431768095670, 340282366920938463463374607431768101058, 340282366920938463463374607431764101534
],

vector<u128>[
  2758623, 9367874, 1768513, 17787704, 155733152, 106761360, 621499228, 346607875, 2379147566, 499947, 537206727, 346776325, 1215467857, 3360106329, 665465732, 83534406161, 57419885, 55478988297, 1426055684, 735353241, 30234425, 45609791797, 139536152, 452262500, 192930074, 752707, 4630774951, 10814942394, 1641993929, 348858487929, 154400802933, 154400802933, 1150828663, 348858487929, 18519892, 1236433187, 125281252, 621499228, 415338380, 55441136935, 10814942394, 8114284, 1641993929, 4631274898, 397227305, 953028723, 78351762262, 2426140, 49469496, 195774820, 590518184, 763386789, 45094512171, 747271978, 4019776768, 4762008646, 752707, 1262775948, 17787704, 54993745, 3894614, 2140250, 3401959, 636290373, 537206727, 2758623, 9367874, 208408875, 61584321, 25342031, 2248183, 8336743, 2359784, 104, 115682, 4085437, 134883, 188068490, 81924706, 23573518, 2248183, 8336743, 2359784, 115786, 110398, 4109922
],

vector<u128>[
  809139250958318172, 880925665593277511, 643763415893406868, 801426954430416442, 814463618462282630, 807357351518739646, 805290779727683588, 686157252530515786, 801405133229224918, 851004976908931476, 739985333759918544, 886034095916428108, 739985333759918544, 728358581128348701, 643605615900009264, 728601981650846734, 880910097573281379, 646264843273633457, 646658095459511266, 647069221958894531, 830635966604968207, 740766190662813641, 836775559652776348, 680230914387451471, 863493789071190226, 770634216922959684, 905571173934675525, 905571173934675525, 867448061639392089, 905571173934675525, 905571173934675525, 0, 58093073414407810, 0, 33637835069639453, 18616201884170647, 14001124844481547, 9118344169917280, 18517779204330342, 0, 0, 0, 0, 0, 2265134018379179, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 34974931022406149, 34727065795979731, 38969487192422840, 19629293844058297, 145945403541563247, 58576565836915784, 59032359714090001, 61351493834511276, 56172578979680373, 66734145429547696, 0, 0, 0, 0, 26606652454044844, 0, 0, 0, 0
],

vector<u128>[
  23909008613323579, 25690653110136277, 20470509988920048, 23755570071614507, 23948868502470435, 23878769831583239, 23848151908466575, 21240901026041888, 23739851569038113, 24920558382409375, 22573981654341266, 25794249249833672, 22573116001353742, 22266574163744719, 20463303861973998, 22266669896524885, 25652233765728678, 20517356456620691, 20525689775283243, 20536730795076510, 24567782520683183, 22585563741590372, 24677156811944198, 21258404434578817, 25232758712606302, 23287265542084149, 26217727919891077, 26217727919891077, 25359180125487263, 26217727919891077, 26217727919891077, 0, 1351815036247991, 0, 757027384817838, 432023933547746, 325033288238136, 212349846875968, 347035196301098, 0, 0, 0, 0, 0, 55289094898639, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1034894166604255, 1034894166604255, 1196801859861610, 442935772313057, 5766273923227070, 2029064885410126, 2049020018553475, 2155199031774412, 1940715806218849, 2366320591523946, 0, 0, 0, 0, 1202793443461889, 0, 0, 0, 0
],

vector<u128>[
  14603153332719834328998899, 14603194613047226634402646, 14577867675670796234731244, 14603143389595872142350770, 14603155116502222685856689, 14603151019471376808408621, 14603147020567502792917674, 14585240194522912404107462, 14603143134637274946899101, 14603172874730047079310296, 14603104875522659248248349, 14603196075350855749273968, 14603104803075256121843657, 14603093271239827756347748, 14577863690611253604754948, 14603091917482319125215720, 14603194365366451370160242, 14577865976786316333478046, 14577865259030690634351221, 14577861863329247842089916, 14603162775125897106427911, 14603102990501106384995572, 14603164715426556347757053, 14579472910628381316650585, 14603182690778867379236932, 14603126632696466580552168, 14603215280774306934953697, 14603220802166232207195962, 14603184971021642826637171, 14603232868257327958674943, 14603233873697334358950826, 0, 56963132643504350673, 0, 39762666714199551162, 25136867035177169222, 20592242365442573288, 12903005473044428104, 14885404796769154716, 262917208396663265, 0, 0, 0, 0, 1002545092024528503, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1871057786429930290222, 1875743652140058622800, 2056822531007748981467, 655468404021545271749, 5642405540669978595378, 3448134903028367254182, 3488311293913155651149, 3561353557209401729264, 3353468899833360315275, 3820789209571792578356, 0, 0, 0, 0, 389150902960120834694, 0, 0, 0, 0
],

vector<vector<u128>>[
  vector<u128>[1521916400510752111609, 75659330916060570680],
  vector<u128>[1561421853890601732618, 126350476038091411019],
  vector<u128>[1142870174726393995336],
  vector<u128>[1509586137660818272061, 63329068066126731132],
  vector<u128>[1524128432129493194452, 77871362539191786539],
  vector<u128>[1519047788832279157374, 72790719237587616445],
  vector<u128>[1514088830655176614011, 67831761060485073082],
  vector<u128>[1256822400635094311279],
  vector<u128>[1509269968765486610763, 63012899170795069834],
  vector<u128>[1546150021993289857941, 99892952402988450028],
  vector<u128>[1461825630204352370863, 15568560609660829934],
  vector<u128>[1561421853890601732618, 127982511338442829953],
  vector<u128>[1461735789674681730122, 15478720079990189193],
  vector<u128>[1447435398518474517829, 1178328923782976900],
  vector<u128>[1142808580254495012182],
  vector<u128>[1446262384796764461251, 1244410708569993],
  vector<u128>[1561421853890601732618, 126074046601412569031],
  vector<u128>[1143899937364157306337, 1069349569253034178],
  vector<u128>[1143900739450139171013, 1081395679561700851],
  vector<u128>[1144103781542109721010, 1340148008067235513],
  vector<u128>[1533625723815749266976, 87368654225447859063],
  vector<u128>[1459488053315303773490, 13230983725002365577],
  vector<u128>[1536031848219197518377, 89774778628896110464],
  vector<u128>[1183710900232916865723, 16231968740931290319],
  vector<u128>[1558322689409275853050, 112065619818974445137],
  vector<u128>[1488806248536326271101, 42549178946024863188],
  vector<u128>[1561421853890601732618, 143560572023995489881],
  vector<u128>[1561421853890601732618, 143560572023995489881],
  vector<u128>[1561150368594797461249, 114893299004496053336],
  vector<u128>[1561421853890601732618, 143560572023995489881],
  vector<u128>[1561421853890601732618, 143560572023995489881],
  vector<u128>[0, 0],
  vector<u128>[12431556445745552998, 40827344169440718174],
  vector<u128>[0, 0],
  vector<u128>[1806899303684579869, 24251507032856659100],
  vector<u128>[671319813488874812, 13037493568502885547],
  vector<u128>[0, 9027094981864791717],
  vector<u128>[0, 4960948525356926793],
  vector<u128>[12321837906950250619, 14316922828786309476],
  vector<u128>[0, 0],
  vector<u128>[0, 0],
  vector<u128>[0, 0],
  vector<u128>[0, 0],
  vector<u128>[0, 0],
  vector<u128>[1243235481181210957, 1243235481181210957],
  vector<u128>[0, 0],
  vector<u128>[0],
  vector<u128>[0, 0],
  vector<u128>[0, 0],
  vector<u128>[0, 0],
  vector<u128>[0, 0],
  vector<u128>[0, 0],
  vector<u128>[0, 0],
  vector<u128>[0, 0],
  vector<u128>[0],
  vector<u128>[0, 0],
  vector<u128>[0, 0],
  vector<u128>[0, 0],
  vector<u128>[0, 0],
  vector<u128>[0, 0],
  vector<u128>[0],
  vector<u128>[0],
  vector<u128>[0],
  vector<u128>[0, 0],
  vector<u128>[0, 0],
  vector<u128>[0, 0],
  vector<u128>[0, 0],
  vector<u128>[],
  vector<u128>[],
  vector<u128>[],
  vector<u128>[],
  vector<u128>[],
  vector<u128>[],
  vector<u128>[],
  vector<u128>[],
  vector<u128>[],
  vector<u128>[],
  vector<u128>[],
  vector<u128>[],
  vector<u128>[],
  vector<u128>[],
  vector<u128>[],
  vector<u128>[],
  vector<u128>[],
  vector<u128>[],
  vector<u128>[]
],

vector<u128>[
  2758623, 9367874, 1768513, 17787704, 155733152, 106761360, 621499228, 346607875, 2379147566, 0, 0, 0, 0, 3360106329, 543536449, 83534406161, 57419885, 55442338017, 1426055684, 2200877, 0, 45606400409, 136648602, 452262500, 192930074, 0, 4630774951, 10814942394, 1641993929, 348858487929, 154400802933, 340282366920938463463374607277367408523, 340282366920938463463374607430633611361, 340282366920938463463374607082909723527, 0, 340282366920938463463374607430531778269, 340282366920938463463374607431661450096, 340282366920938463463374607431146712228, 340282366920938463463374607431352873076, 340282366920938463463374607376327074521, 340282366920938463463374607420953269062, 340282366920938463463374607431760097172, 340282366920938463463374607430126217527, 340282366920938463463374607427137436505, 340282366920938463463374607431421603581, 340282366920938463463374607430818070283, 340282366920938463463374607353538378477, 340282366920938463463374607431765785316, 340282366920938463463374607431718741960, 340282366920938463463374607431612478304, 340282366920938463463374607431524469597, 0, 340282366920938463463374607386673699285, 340282366920938463463374607431020939478, 340282366920938463463374607428913283115, 340282366920938463463374607427006202810, 0, 340282366920938463463374607430505435508, 340282366920938463463374607431750423752, 340282366920938463463374607431713217711, 340282366920938463463374607431764316842, 340282366920938463463374607431766071206, 340282366920938463463374607431764809497, 340282366920938463463374607431131921083, 0, 340282366920938463463374607431765452833, 340282366920938463463374607431758843582, 0, 0, 340282366920938463463374607431766442943, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0
],

vector<u128>[
  0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 5218251119584250593u128, 10465132780418527685u128, 0u128, 21056140276817252232u128, 21705883294148754193u128, 0u128, 20607228941780709535u128, 0u128, 17785044030445013104u128, 13274309158505637932u128, 12205492532511288430u128, 8217959725704967499u128, 3073983415231458058u128, 248196509745639385u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128, 0u128
],
            ctx
        )
    }

    #[test]
    fun test_recovery_eth() {
        let mut scenario = test_scenario::begin(@0x1);
        let tick_manager = setup_tick_manager(scenario.ctx());

        let (calculated_liquidity, calculated_staked_liquidity) = tick_manager.calc_current_liquidity(current_tick_index());

        assert!(calculated_liquidity == current_liqudity(), 1);
        assert!(calculated_staked_liquidity <= current_liqudity(), 2);
        assert!(calculated_staked_liquidity == current_staked_liquidity(), 3);

        test_utils::destroy(tick_manager);
        scenario.end();
    }

}